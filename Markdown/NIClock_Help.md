## Clock Source Notes

### Table of Calibrated Values

SpikeGLX maintains a table of NI clock sources in the file

* `_Calibration\calibrated_sample_rates_nidq.ini`

The entries in this table have the form:

```
Name : Set_rate=Measured_rate
```

* **Name**: This is just a label you provide to help you recognize
different sources you might use in your lab. We expect you might
pick a name like `Whisper` if you are using a Janelia-built
Whisper multiplexer, or `Internal` if electing to use program
the NI device's own internal Ctr0 clock. We now auto-generate a
suggestion for your convenience.

* **Set_rate**: This is the rate that is used to program a clock,
for example, a Whisper's clock is nominally 25000 Hz, or you
might set 25000 Hz to program the NI internal clock.

* **Measured_rate**: Until you have done a calibration the measured rate
is initialized to be the `Set_rate`. When you use the SpikeGLX calibration
features, the measured rate is updated with a more accurate measurement
result. In any case, the `Measured_rate` is used as the best available
estimator of the true sampling rate for the device.

### Simultaneous Sampling vs Multiplexing

_How fast can the device go?_

S-series (61xx) and some X-series (63xx) devices support simultaneous
sampling, which means that each AI channel has its own amplifier and ADC,
so can digitize samples independently and in parallel. These devices can
sample at their maximum advertised rate at any channel count.

By contrast, M-series (62xx) and some X-series devices have a single
amplifier/ADC pipeline that is shared by all AI channels. The inputs
are switched into the digitizer in a serial fashion, one at a time.
The `maximum` rate these multiplexing devices can go is the advertised
sample rate `R0` divided by the number of channels: `R0/nchan`.

The shortest time it takes to digitize a sample is the `convert period`
which is `1/R0`. However, when multiplexed inputs are switched it takes
a small amount of time to allow charge from the previous sample to
dissipate and the amplifier to settle to the new nominal charge level.
To avoid crosstalk and get better accuracy, NI recommends that an
estimated settling time of `1e-5 seconds` be added to the convert period.
The `safe rate` is then `1/(1/R0 + 1e-5)`.

### Internal Clock Step-down Factor

_What sample rate can I actually program?_

Digitizing hardware needs to be driven by a square wave: a `clock source`
that can be generated by another external device or by the internal pulse
counter (`Ctr0`) on-board the NI device. If using an external clock, its
rate is what it is. We allow you to directly set that value into the
rate box; it is only limited by the device's maximum (up to 1 MHz).

However, when the internal source is selected, we program its rate by
defining a task that counts a specified number of whole pulses of the
device's master timebase. That is, realizable rates are limited to:
`timebase/integer`. In this case, you must enter the integer and we
put the result into the rate box.


_fin_

